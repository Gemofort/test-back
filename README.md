# Test task, Back-end part

For this project, you need [node.js](https://nodejs.org/en/), npm at least. All the dependencies are listed in package.json file with the engines as well.

## Installation

Use the node package manager ([npm](https://www.npmjs.com/)) to install all of the dependencies for this project.

```bash
npm install
```
or
```bash
npm i
```

Then create default.ts config in your config folder.
Example:
```js
module.exports = {
  server: {
    port: 3000,
    baseUrl: 'http://localhost:3000',
  },
  database: {
    url: 'mongodb+srv://Gemofort:111@test-cluster-vvyof.mongodb.net/tets-back?retryWrites=true&w=majority',
  },
};
```

## Database

[MongoDB](https://www.mongodb.com/) and [mongoose](https://mongoosejs.com/) library are used for this project purposes.
Firstly, you need to create mongo database on MongoDB site link above. Then you need to get your database URL (pattern: 'mongodb+srv://<username>:<password>@test-cluster-vvyof.mongodb.net/<database_name>?retryWrites=true&w=majority')

All the schemas for entities must be types as shown below:
```js
import * as mongoose from 'mongoose';
import { Schema, Document } from 'mongoose';

export enum CarType {
  SEDAN = 'sedan',
  COUPE = 'coupe',
  MINIVAN = 'minivan',
  HATCHBACK = 'hatchback',
  TRUCK = 'truck',
  PICKUP_TRUCK = 'pickup truck',
  CROSSOVER = 'crossover',
}

export enum CarStatus {
  UNAVAILABLE = 'unavailable',
  FREE = 'free',
}

export interface ICar extends Document {
  numberPlate: string;
  type: CarType;
  modelType: string;
  soldAt: Date;
  mileage: number;
  status: CarStatus;
}

const carSchema: Schema = new Schema({
  numberPlate: { type: String, required: true },
  type: { type: String, required: true },
  modelType: { type: String, required: true },
  soldAt: { type: Date, required: true },
  mileage: { type: Number, requried: true },
  status: { type: String, required: true },
});

export default mongoose.model<ICar>('Car', carSchema);

```


## Routing

All of the routes consists of 3 parts: route string, route validation, route controller as shown in the example below.
```js
import * as Router from 'koa-joi-router';
const carsRouter = Router();

carsRouter.post(
  '/cars',
  CarsValidator.createCar,
  CarsController.createCar,
);
```

[Koa-joi-router](https://www.npmjs.com/package/koa-joi-router) is used for constructing routes with joi validation. The example of building route validator is shown below as well.
```js
const joi = Router.Joi;

export const carBaseJoiSchema = {
  numberPlate: joi.string().required(),
  type: joi.string().valid(...Object.values(CarType)).required(),
  modelType: joi.string().required(),
  soldAt: joi.date().required(),
  mileage: joi.number().required(),
  status: joi.string().valid(...Object.values(CarStatus)),
};

export class CarsValidator {
  static createCar: Router.Config = {
    meta: {
      swagger: {
        summary: 'Create car',
        description: 'Create car instance',
        tags: ['cars'],
      },
    },
    validate: {
      type: 'json',
      body: { ...carBaseJoiSchema },
      output: {
        201: {
          body: {
            _id: joi.string().required(),
            ...carBaseJoiSchema,
          },
        },
        400: {
          body: {
            error: joi.string(),
          },
        },
      },
    },
  };
}
```

After all of that we need to specify controller for our route:
```js
export class CarsController {
  static async createCar(ctx: Context) {
    const { numberPlate, type, modelType, soldAt, mileage } = ctx.request.body;

    const car = await (new Car({
      numberPlate,
      type,
      modelType,
      mileage,
      status: CarStatus.FREE,
      soldAt: new Date(soldAt),
    })).save();

    ctx.status = 201;
    ctx.body = {
      numberPlate,
      type,
      modelType,
      mileage,
      status: car.status,
      _id: car._id.toString(),
      soldAt: car.soldAt,
    };
  }
}
```

Be careful, all of the responses must be the same pattern and types as you did in validation part.

## Docs

Docs are generated by using [koa-joi-router-docs](https://www.npmjs.com/package/koa-joi-router-docs) and listed on '/docs' route.

## Contributing
Pull requests are welcome. For major changes, please open an issue first to discuss what you would like to change.

## License
[MIT](https://choosealicense.com/licenses/mit/)